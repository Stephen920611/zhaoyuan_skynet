window.emap=window.emap||{};emap.main=emap.main||{};emap.main={menuContext:null,mapTileUrl:null,map:null,infowin:null,drawingManager:null,maxZoom:18,minZoom:5,_func:"emap",setFunc:function(a){this._func=a},getFunc:function(){return this._func},style:{fillColor:"#13c2f7",strokeColor:"#468EF7",strokeWeight:3,strokeOpacity:0.8,fillOpacity:0.1},options:{center:null,zoom:14,mapTypeControl:true,streetViewControl:false,zoomControl:true,panControl:true,scaleControl:true,scaleControlOptions:{position:google.maps.ControlPosition.BOTTOM_LEFT},mapTypeControlOptions:{mapTypeIds:["satel","localMap"],position:google.maps.ControlPosition.TOP_RIGHT}},init:function(a,f,e,b){this.mapTileUrl=f;var d=new emap.main.MapEntity(f,"map",this.maxZoom,this.minZoom);d.name="电子地图";var c=new emap.main.MapEntity(f,"satellite",this.maxZoom,this.minZoom);c.name="卫星影像";this.options.center=new google.maps.LatLng(e,b);map=new google.maps.Map(a,this.options);map.mapTypes.set("localMap",d);map.mapTypes.set("satel",c);map.setMapTypeId("localMap");this.map=map;this.setupEvents();menuContext=new MenuControl(map);menuContext.sender=map;this.initMenuContext(map,menuContext)},setupEvents:function(){var b=this.map;var a=new google.maps.drawing.DrawingManager({drawingControl:false,polylineOptions:this.style,circleOptions:this.style,rectangleOptions:this.style,polygonOptions:this.style});a.setMap(b);this.drawingManager=a;google.maps.event.addListener(b,"mousemove",function(c){emap.event.mouseMove(c)});google.maps.event.addListener(b,"zoom_changed",function(c){emap.event.zoomChanged(b,c)});google.maps.event.addListener(b,"bounds_changed",function(c){});var a=this.drawingManager;google.maps.event.addListener(a,"polygoncomplete",function(c){});google.maps.event.addListener(a,"overlaycomplete",function(c){emap.event.overlayComplete(c)})},MapEntity:function(d,c,a,e){var b=this;b.tileSize=new google.maps.Size(256,256);b.maxZoom=a;b.minZoom=e;b.getTile=function(j,h,g){var f=g.createElement("img");f.style.width=this.tileSize.width+"px";f.style.height=this.tileSize.height+"px";var i=d+c+"/";i+=h+"/"+j.x+"/"+j.y+".png";f.src=i;f.onerror=function(){f.src=d+"images/noimg.jpg"};return f}},initMenuContext:function(a,b){b.addSeparator("map");b.addItem(new MenuItem({text:"放大一级",icon:"images/zoomax.png",groupName:"map",handler:function(c){emap.main.zoomIn(1)}}));b.addItem(new MenuItem({text:"缩小一级",icon:"images/zoomin.png",groupName:"map",handler:function(c){emap.main.zoomOut(1)}}));google.maps.event.addListener(a,"rightclick",function(c){if(b.isEnable){b.coordinate={point:c.pixel,latlng:c.latLng};b.container.style.left=c.pixel.x+"px";b.container.style.top=c.pixel.y+"px";b.show("map")}})},getMarker:function(h,f,d,e,g){var c=new google.maps.LatLng(f,d);var b=this.getIcon(e);var a=new google.maps.Marker({id:h,position:c,icon:b,type:e,draggable:false,visible:true,title:g});return a},getMarkerWithMap:function(f,d,b,c,e){var a=this.getMarker(f,d,b,c,e);a.setMap(this.map);return a},getIcon:function(a){return this.mapTileUrl+"icon/"+a+".png"},getMap:function(){return this.map},addLabel:function(d,c,e){var b=new google.maps.LatLng(d,c);var a=new MapLabel({text:e,position:b,map:this.map,fontSize:22,fontColor:"#ef5a08",strokeColor:"#f9f9f9",align:"left"});return a},zoomIn:function(a){var b=map.getZoom()+a;if(b<this.maxZoom){map.setZoom(b)}else{map.setZoom(this.maxZoom)}},zoomOut:function(a){var b=map.getZoom()-a;if(b>this.minZoom){map.setZoom(b)}else{map.setZoom(this.minZoom)}},getLevel:function(){return map.getZoom()},pan2Point:function(c,b){var a=new google.maps.LatLng(c,b);map.panTo(a)},setZoom:function(a){map.setZoom(a)},move2PointByEvent:function(c){var d=c.latLng.lat();var b=c.latLng.lng();var a=new google.maps.LatLng(d,b);map.panTo(a)},move2PointByMarker:function(a){this.map.panTo(a.position)},showInfoWin:function(a,b){this.closeInfoWin();infowin=new google.maps.InfoWindow({content:b});this.infowin=infowin;this.infowin.open(this.map,a)},closeInfoWin:function(){var a=this.infowin;if(a){a.close()}},closeInfoWinDelay:function(a){setTimeout(function(b){emap.main.closeInfoWin()},a)},drawLine:function(b){var a=new google.maps.Polyline({path:b,map:this.map,strokeColor:"#468EF7",strokeOpacity:"0.8",strokeWeight:"3"});return a},getMapPoint:function(b,a){return new google.maps.LatLng(b,a)},setDrawModel:function(a){switch(a){case"rectangle":this.drawingManager.setDrawingMode(google.maps.drawing.OverlayType.RECTANGLE);break;case"polyline":this.drawingManager.setDrawingMode(google.maps.drawing.OverlayType.POLYLINE);break;case"polygon":this.drawingManager.setDrawingMode(google.maps.drawing.OverlayType.POLYGON);break;case"circle":this.drawingManager.setDrawingMode(google.maps.drawing.OverlayType.CIRCLE);break;case"marker":this.drawingManager.setDrawingMode(google.maps.drawing.OverlayType.MARKER);break;default:alert("绘制类型错误！")}},getGatherMarkerWithContent:function(g,b,e){var f=this;var h=emap.extension.getMarkerLabel(google.maps);var c=emap.main.getIcon(22);var d=new google.maps.LatLng(g,b);var a=new h({position:d,map:this.map,draggable:false,raiseOnDrag:true,icon:c,labelContent:e,labelAnchor:new google.maps.Point(21,37),labelClass:"marker-label",labelInBackground:false});return a},drawPolygon:function(c,b){var a=new google.maps.Polygon({paths:c,strokeColor:b.strokeColor||"#FF0000",strokeOpatity:b.strokeOpatity||0.8,strokeWeight:b.strokeWeight||2,fillColor:b.fillColor||"#FF0000",fillOpacity:b.fillOpacity||0.35});a.setMap(this.map);return a},getGatherMarker:function(f,i,h){var g=this;var a=emap.extension.getMarkerLabel(google.maps);var k=emap.main.getIcon("blank");var l=emap.main.getIcon("23");var b=new google.maps.LatLng(f,i);var d=document.createElement("div");d.style.background="url("+l+")";d.style.width="30px";d.style.height="30px";d.style["margin-left"]="-35px";d.style["margin-top"]="15px";var e=document.createElement("span");e.style.display="block";e.style.color="white";e.style["font-size"]="13px";e.style.width="30px";e.style["text-align"]="center";e.style["padding-top"]="9px";e.innerHTML=h.length;d.appendChild(e);var j=document.createElement("img");j.src=l;var c=new a({position:b,map:this.map,draggable:false,raiseOnDrag:true,icon:k,labelContent:d,labelAnchor:new google.maps.Point(0,0),labelClass:"marker-label",labelInBackground:false});google.maps.event.addListener(c,"click",function(s){g.pan2Point(f,i);var m=emap.util.getPixelPoint(f,i);var r=h.length;var n=2*Math.PI/r;var q=40;if(r<=8){emap.work.clearClusterSubMarkers();var p=new Array();for(var o=0;o<r;o++){(function(){var A=o;var t=m.x+q*Math.cos(A*n);var B=m.y+q*Math.sin(A*n);var z=new google.maps.Point(t+20,B+40);var w=emap.util.getLatLngFromPoint(z);var u=g.getMarker(1,w.lat(),w.lng(),"2",null);p.push(u);var v=h[A];u.setMap(emap.main.getMap());google.maps.event.addListener(u,"click",function(x){})})()}emap.work.setClusterSubMarkers(p)}});google.maps.event.addListener(c,"rightclick",function(m){});return c},getClusterMarker:function(g,d,c){var h=emap.extension.getMarkerLabel(google.maps);var f=emap.main.getIcon("blank");var e=new google.maps.LatLng(g,d);var a=document.createElement("span");a.title="摄像机数量："+c;a.style.color="white";a.style["font-size"]="13px";a.style["text-align"]="center";a.innerHTML=c;var b=new h({position:e,map:this.map,draggable:false,raiseOnDrag:true,icon:f,labelContent:a,labelAnchor:new google.maps.Point(-12,40),labelClass:"marker-label",labelInBackground:false})}};