(function(b,c,a){if(typeof module!=="undefined"&&module.exports){module.exports=a(require("heatmap.js"),require("google-maps"))}else{if(typeof define==="function"&&define.amd){define(["heatmap.js","google-maps"],a)}else{if(typeof window.h337==="undefined"){throw new Error("heatmap.js must be loaded before the gmaps heatmap plugin")}if(typeof window.google==="undefined"){throw new Error("Google Maps must be loaded before the gmaps heatmap plugin")}c[b]=a(window.h337,window.google.maps)}}})("HeatmapOverlay",this,function(b,a){var c=function(e,d){this.setMap(e);this.initialize(d||{})};c.prototype=new a.OverlayView();c.CSS_TRANSFORM=(function(){var g=document.createElement("div");var e=["transform","WebkitTransform","MozTransform","OTransform","msTransform"];for(var d=0;d<e.length;d++){var f=e[d];if(g.style[f]!==undefined){return f}}return e[0]})();c.prototype.initialize=function(f){this.cfg=f;var i=this.map=this.getMap();var e=this.container=document.createElement("div");var g=i.getDiv();var h=this.width=g.clientWidth;var d=this.height=g.clientHeight;e.style.cssText="width:"+h+"px;height:"+d+"px;";this.data=[];this.max=1;this.min=0;f.container=e};c.prototype.onAdd=function(){var d=this;this.getPanes().overlayLayer.appendChild(this.container);this.changeHandler=a.event.addListener(this.map,"bounds_changed",function(){return d.draw()});if(!this.heatmap){this.heatmap=b.create(this.cfg)}this.draw()};c.prototype.onRemove=function(){if(!this.map){return}this.map=null;this.container.parentElement.removeChild(this.container);if(this.changeHandler){a.event.removeListener(this.changeHandler);this.changeHandler=null}};c.prototype.draw=function(){if(!this.map){return}var g=this.map.getBounds();var f=new a.LatLng(g.getNorthEast().lat(),g.getSouthWest().lng());var e=this.getProjection();var d=e.fromLatLngToDivPixel(f);this.container.style[c.CSS_TRANSFORM]="translate("+Math.round(d.x)+"px,"+Math.round(d.y)+"px)";this.update()};c.prototype.resize=function(){if(!this.map){return}var f=this.map.getDiv(),e=f.clientWidth,d=f.clientHeight;if(e==this.width&&d==this.height){return}this.width=e;this.height=d;this.heatmap._renderer.setDimensions(e,d);this.update()};c.prototype.update=function(){var v=this.getProjection(),e,w,l,q;var p={max:this.max,min:this.min,data:[]};if(!v){return}l=this.map.getBounds();q=new a.LatLng(l.getNorthEast().lat(),l.getSouthWest().lng());e=this.map.getZoom();w=Math.pow(2,e);if(!this.heatmap){this.heatmap=b.create(this.cfg)}this.resize();if(this.data.length==0){if(this.heatmap){this.heatmap.setData(p)}return}var j=[];var t=this.data.length;var f=this.getProjection();var u=f.fromLatLngToDivPixel(q);var i=this.cfg.scaleRadius?w:1;var n=0;var k=0;var d=this.cfg.valueField;while(t--){var g=this.data[t];var r=g[d];var m=g.latlng;if(!l.contains(m)){continue}n=Math.max(r,n);k=Math.min(r,k);var s=f.fromLatLngToDivPixel(m);var o={x:Math.round(s.x-u.x),y:Math.round(s.y-u.y)};o[d]=r;var h;if(g.radius){h=g.radius*i}else{h=(this.cfg.radius||2)*i}o.radius=h;j.push(o)}if(this.cfg.useLocalExtrema){p.max=n;p.min=k}p.data=j;this.heatmap.setData(p)};c.prototype.setData=function(g){this.max=g.max;this.min=g.min;var i=this.cfg.latField||"lat";var h=this.cfg.lngField||"lng";var m=this.cfg.valueField||"value";var g=g.data;var j=g.length;var k=[];while(j--){var l=g[j];var f=new a.LatLng(l[i],l[h]);var e={latlng:f};e[m]=l[m];if(l.radius){e.radius=l.radius}k.push(e)}this.data=k;this.update()};c.prototype.addData=function(e){if(e.length>0){var d=e.length;while(d--){this.addData(e[d])}}else{var g=this.cfg.latField||"lat";var j=this.cfg.lngField||"lng";var h=this.cfg.valueField||"value";var i=e;var k=new a.LatLng(i[g],i[j]);var f={latlng:k};f[h]=i[h];if(i.radius){f.radius=i.radius}this.max=Math.max(this.max,f[h]);this.min=Math.min(this.min,f[h]);this.data.push(f);this.update()}};return c});