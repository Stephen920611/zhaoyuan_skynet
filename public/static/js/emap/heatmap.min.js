(function(e,d,f){if(typeof module!=="undefined"&&module.exports){module.exports=f()}else{if(typeof define==="function"&&define.amd){define(f)}else{d[e]=f()}}})("h337",this,function(){var v={defaultRadius:40,defaultRenderer:"canvas2d",defaultGradient:{0.25:"rgb(0,0,255)",0.55:"rgb(0,255,0)",0.85:"yellow",1:"rgb(255,0,0)"},defaultMaxOpacity:1,defaultMinOpacity:0,defaultBlur:0.85,defaultXField:"x",defaultYField:"y",defaultValueField:"value",plugins:{}};var u=function o(){var a=function e(b){this._coordinator={};this._data=[];this._radi=[];this._min=0;this._max=1;this._xField=b.xField||b.defaultXField;this._yField=b.yField||b.defaultYField;this._valueField=b.valueField||b.defaultValueField;if(b.radius){this._cfgRadius=b.radius}};var f=v.defaultRadius;a.prototype={_organiseData:function(E,D){var C=E[this._xField];var B=E[this._yField];var A=this._radi;var z=this._data;var y=this._max;var x=this._min;var w=E[this._valueField]||1;var c=E.radius||this._cfgRadius||f;if(!z[C]){z[C]=[];A[C]=[]}if(!z[C][B]){z[C][B]=w;A[C][B]=c}else{z[C][B]+=w}if(z[C][B]>y){if(!D){this._max=z[C][B]}else{this.setDataMax(z[C][B])}return false}else{return{x:C,y:B,value:w,radius:c,min:x,max:y}}},_unOrganizeData:function(){var h=[];var g=this._data;var k=this._radi;for(var j in g){for(var i in g[j]){h.push({x:j,y:i,radius:k[j][i],value:g[j][i]})}}return{min:this._min,max:this._max,data:h}},_onExtremaChange:function(){this._coordinator.emit("extremachange",{min:this._min,max:this._max})},addData:function(){if(arguments[0].length>0){var g=arguments[0];var d=g.length;while(d--){this.addData.call(this,g[d])}}else{var h=this._organiseData(arguments[0],true);if(h){this._coordinator.emit("renderpartial",{min:this._min,max:this._max,data:[h]})}}return this},setData:function(h){var g=h.data;var j=g.length;this._data=[];this._radi=[];for(var i=0;i<j;i++){this._organiseData(g[i],false)}this._max=h.max;this._min=h.min||0;this._onExtremaChange();this._coordinator.emit("renderall",this._getInternalData());return this},removeData:function(){},setDataMax:function(b){this._max=b;this._onExtremaChange();this._coordinator.emit("renderall",this._getInternalData());return this},setDataMin:function(b){this._min=b;this._onExtremaChange();this._coordinator.emit("renderall",this._getInternalData());return this},setCoordinator:function(b){this._coordinator=b},_getInternalData:function(){return{max:this._max,min:this._min,data:this._data,radi:this._radi}},getData:function(){return this._unOrganizeData()}};return a}();var t=function n(){var f=function(j){var i=j.gradient||j.defaultGradient;var y=document.createElement("canvas");var x=y.getContext("2d");y.width=256;y.height=1;var w=x.createLinearGradient(0,0,256,1);for(var k in i){w.addColorStop(k,i[k])}x.fillStyle=w;x.fillRect(0,0,256,1);return x.getImageData(0,0,256,1).data};var e=function(j,i){var z=document.createElement("canvas");var y=z.getContext("2d");var x=j;var w=j;z.width=z.height=j*2;if(i==1){y.beginPath();y.arc(x,w,j,0,2*Math.PI,false);y.fillStyle="rgba(0,0,0,1)";y.fill()}else{var k=y.createRadialGradient(x,w,j*i,x,w,j);k.addColorStop(0,"rgba(0,0,0,1)");k.addColorStop(1,"rgba(0,0,0,0)");y.fillStyle=k;y.fillRect(0,0,2*j,2*j)}return z};var h=function(I){var H=[];var G=I.min;var F=I.max;var E=I.radi;var I=I.data;var D=Object.keys(I);var C=D.length;while(C--){var B=D[C];var A=Object.keys(I[B]);var z=A.length;while(z--){var y=A[z];var x=I[B][y];var w=E[B][y];H.push({x:B,y:y,value:x,radius:w})}}return{min:G,max:F,data:H}};function g(a){var x=a.container;var w=this.shadowCanvas=document.createElement("canvas");var k=this.canvas=a.canvas||document.createElement("canvas");var j=this._renderBoundaries=[10000,10000,0,0];var i=getComputedStyle(a.container)||{};k.className="heatmap-canvas";this._width=k.width=w.width=a.width||+i.width.replace(/px/,"");this._height=k.height=w.height=a.height||+i.height.replace(/px/,"");this.shadowCtx=w.getContext("2d");this.ctx=k.getContext("2d");k.style.cssText=w.style.cssText="position:absolute;left:0;top:0;";x.style.position="relative";x.appendChild(k);this._palette=f(a);this._templates={};this._setStyles(a)}g.prototype={renderPartial:function(b){if(b.data.length>0){this._drawAlpha(b);this._colorize()}},renderAll:function(b){this._clear();if(b.data.length>0){this._drawAlpha(h(b));this._colorize()}},_updateGradient:function(a){this._palette=f(a)},updateConfig:function(b){if(b.gradient){this._updateGradient(b)}this._setStyles(b)},setDimensions:function(d,c){this._width=d;this._height=c;this.canvas.width=this.shadowCanvas.width=d;this.canvas.height=this.shadowCanvas.height=c},_clear:function(){this.shadowCtx.clearRect(0,0,this._width,this._height);this.ctx.clearRect(0,0,this._width,this._height)},_setStyles:function(b){this._blur=b.blur==0?0:b.blur||b.defaultBlur;if(b.backgroundColor){this.canvas.style.backgroundColor=b.backgroundColor}this._width=this.canvas.width=this.shadowCanvas.width=b.width||this._width;this._height=this.canvas.height=this.shadowCanvas.height=b.height||this._height;this._opacity=(b.opacity||0)*255;this._maxOpacity=(b.maxOpacity||b.defaultMaxOpacity)*255;this._minOpacity=(b.minOpacity||b.defaultMinOpacity)*255;this._useGradientOpacity=!!b.useGradientOpacity},_drawAlpha:function(J){var I=this._min=J.min;var H=this._max=J.max;var J=J.data||[];var G=J.length;var F=1-this._blur;while(G--){var E=J[G];var D=E.x;var C=E.y;var B=E.radius;var A=Math.min(E.value,H);var z=D-B;var y=C-B;var x=this.shadowCtx;var w;if(!this._templates[B]){this._templates[B]=w=e(B,F)}else{w=this._templates[B]}var b=(A-I)/(H-I);x.globalAlpha=b<0.01?0.01:b;x.drawImage(w,z,y);if(z<this._renderBoundaries[0]){this._renderBoundaries[0]=z}if(y<this._renderBoundaries[1]){this._renderBoundaries[1]=y}if(z+2*B>this._renderBoundaries[2]){this._renderBoundaries[2]=z+2*B}if(y+2*B>this._renderBoundaries[3]){this._renderBoundaries[3]=y+2*B}}},_colorize:function(){var N=this._renderBoundaries[0];var M=this._renderBoundaries[1];var L=this._renderBoundaries[2]-N;var K=this._renderBoundaries[3]-M;var J=this._width;var I=this._height;var H=this._opacity;var G=this._maxOpacity;var F=this._minOpacity;var E=this._useGradientOpacity;if(N<0){N=0}if(M<0){M=0}if(N+L>J){L=J-N}if(M+K>I){K=I-M}var D=this.shadowCtx.getImageData(N,M,L,K);var C=D.data;var B=C.length;var A=this._palette;for(var z=3;z<B;z+=4){var y=C[z];var x=y*4;if(!x){continue}var w;if(H>0){w=H}else{if(y<G){if(y<F){w=F}else{w=y}}else{w=G}}C[z-3]=A[x];C[z-2]=A[x+1];C[z-1]=A[x+2];C[z]=E?A[x+3]:w}D.data=C;this.ctx.putImageData(D,N,M);this._renderBoundaries=[1000,1000,0,0]},getValueAt:function(j){var i;var z=this.shadowCtx;var y=z.getImageData(j.x,j.y,1,1);var x=y.data[3];var w=this._max;var k=this._min;i=Math.abs(w-k)*(x/255)>>0;return i},getDataURL:function(){return this.canvas.toDataURL()}};return g}();var s=function m(){var a=false;if(v.defaultRenderer==="canvas2d"){a=t}return a}();var r={merge:function(){var g={};var f=arguments.length;for(var j=0;j<f;j++){var i=arguments[j];for(var h in i){g[h]=i[h]}}return g}};var q=function l(){var e=function a(){function c(){this.cStore={}}c.prototype={on:function(g,f,i){var h=this.cStore;if(!h[g]){h[g]=[]}h[g].push(function(j){return f.call(i,j)})},emit:function(h,g){var w=this.cStore;if(w[h]){var k=w[h].length;for(var j=0;j<k;j++){var i=w[h][j];i(g)}}}};return c}();var d=function(g){var f=g._renderer;var i=g._coordinator;var h=g._store;i.on("renderpartial",f.renderPartial,f);i.on("renderall",f.renderAll,f);i.on("extremachange",function(c){g._config.onExtremaChange&&g._config.onExtremaChange({min:c.min,max:c.max,gradient:g._config.gradient||g._config.defaultGradient})});h.setCoordinator(i)};function b(){var j=this._config=r.merge(v,arguments[0]||{});this._coordinator=new e;if(j.plugin){var f=j.plugin;if(!v.plugins[f]){throw new Error("Plugin '"+f+"' not found. Maybe it was not registered.")}else{var c=v.plugins[f];this._renderer=new c.renderer(j);this._store=new c.store(j)}}else{this._renderer=new s(j);this._store=new u(j)}d(this)}b.prototype={addData:function(){this._store.addData.apply(this._store,arguments);return this},removeData:function(){this._store.removeData&&this._store.removeData.apply(this._store,arguments);return this},setData:function(){this._store.setData.apply(this._store,arguments);return this},setDataMax:function(){this._store.setDataMax.apply(this._store,arguments);return this},setDataMin:function(){this._store.setDataMin.apply(this._store,arguments);return this},configure:function(c){this._config=r.merge(this._config,c);this._renderer.updateConfig(this._config);this._coordinator.emit("renderall",this._store._getInternalData());return this},repaint:function(){this._coordinator.emit("renderall",this._store._getInternalData());return this},getData:function(){return this._store.getData()},getDataURL:function(){return this._renderer.getDataURL()},getValueAt:function(c){if(this._store.getValueAt){return this._store.getValueAt(c)}else{if(this._renderer.getValueAt){return this._renderer.getValueAt(c)}else{return null}}}};return b}();var p={create:function(b){return new q(b)},register:function(a,d){v.plugins[a]=d}};return p});