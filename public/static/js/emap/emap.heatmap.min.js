window.emap=window.emap||{};emap.heatmap=emap.heatmap||{};emap.heatmap={_heatmap:null,init:function(){var a=this;if(a._heatmap){clearHeatMap();a._heatmap=null}a._heatmap=new HeatmapOverlay(emap.main.getMap(),{radius:20,maxOpacity:10,scaleRadius:false,useLocalExtrema:true,latField:"lat",lngField:"lng",valueField:"count"})},getHeatMap:function(){return this._heatmap},clearHeatPoints:function(){var a=this;var b={max:0,data:[]};a._heatmap.setData(b)},clusterHeatPoints:function(d,b){var a=new Array();var c=new utility.hashTable();$.each(d,function(f,g){var e=emap.main.getMarker(g.id,g.lat,g.lng,"","");c.add(g.id,e)});return this.clusterHeatPointsInMarkerHash(c,b)},clusterHeatPointsInMarkerHash:function(e,m){var k=new Array();if(e.getSize()>0){var c=new utility.hashTable();var h=e.getValues();var b=new Array();if(!m){m=50}for(var l=0;l<h.length;l++){var q=h[l];var n=false;var f=m;var s=-1;for(var g=0;g<b.length;g++){var a=emap.util.getDistance(b[g],q.position);if(a<m&&a<f){f=a;s=g}}if(s!=-1){c.getValue(b[s]).push(q);n=true}if(!n){var d=new Array();d.push(q);c.add(q.position,d);b.push(q.position)}}if(b.length>0){var o=this;for(var l=0;l<b.length;l++){var p=c.getValue(b[l]);var r={};r.lat=b[l].lat();r.lng=b[l].lng();r.count=p.length;k.push(r)}}}return k}};