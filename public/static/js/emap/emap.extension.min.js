window.emap=window.emap||{};emap.extension=emap.extension||{};emap.extension={getMarkerLabel:function(a){var d=function(f,e){function g(){}g.prototype=e.prototype;f.superClass_=e.prototype;f.prototype=new g();f.prototype.constructor=f};var b=function(e,f,g){this.marker_=e;this.handCursorURL_=e.handCursorURL;this.labelDiv_=document.createElement("div");this.labelDiv_.style.cssText="position: absolute; overflow: hidden;";this.eventDiv_=document.createElement("div");this.eventDiv_.style.cssText=this.labelDiv_.style.cssText;this.eventDiv_.setAttribute("onselectstart","return false;");this.eventDiv_.setAttribute("ondragstart","return false;");this.crossDiv_=b.getSharedCross(f)};d(b,a.OverlayView);b.getSharedCross=function(e){var f;if(typeof b.getSharedCross.crossDiv==="undefined"){f=document.createElement("img");f.style.cssText="position: absolute; z-index: 1000002; display: none;";f.style.marginLeft="-8px";f.style.marginTop="-9px";f.src=e;b.getSharedCross.crossDiv=f}return b.getSharedCross.crossDiv};b.prototype.onAdd=function(){var o=this;var i=false;var r=false;var p;var l,g;var e;var q;var n;var f;var h=20;var m="url("+this.handCursorURL_+")";var k=function(s){if(s.preventDefault){s.preventDefault()}s.cancelBubble=true;if(s.stopPropagation){s.stopPropagation()}};var j=function(){o.marker_.setAnimation(null)};this.getPanes().markerLayer.appendChild(this.labelDiv_);this.getPanes().overlayMouseTarget.appendChild(this.eventDiv_);if(typeof b.getSharedCross.processed==="undefined"){this.getPanes().markerLayer.appendChild(this.crossDiv_);b.getSharedCross.processed=true}this.listeners_=[a.event.addDomListener(this.eventDiv_,"mouseover",function(s){if(o.marker_.getDraggable()||o.marker_.getClickable()){this.style.cursor="pointer";a.event.trigger(o.marker_,"mouseover",s)}}),a.event.addDomListener(this.eventDiv_,"mouseout",function(s){if((o.marker_.getDraggable()||o.marker_.getClickable())&&!r){this.style.cursor=o.marker_.getCursor();a.event.trigger(o.marker_,"mouseout",s)}}),a.event.addDomListener(this.eventDiv_,"mousedown",function(s){r=false;if(o.marker_.getDraggable()){i=true;this.style.cursor=m}if(o.marker_.getDraggable()||o.marker_.getClickable()){a.event.trigger(o.marker_,"mousedown",s);k(s)}}),a.event.addDomListener(document,"mouseup",function(t){var s;if(i){i=false;o.eventDiv_.style.cursor="pointer";a.event.trigger(o.marker_,"mouseup",t)}if(r){if(q){s=o.getProjection().fromLatLngToDivPixel(o.marker_.getPosition());s.y+=h;o.marker_.setPosition(o.getProjection().fromDivPixelToLatLng(s));try{o.marker_.setAnimation(a.Animation.BOUNCE);setTimeout(j,1406)}catch(u){}}o.crossDiv_.style.display="none";o.marker_.setZIndex(p);e=true;r=false;t.latLng=o.marker_.getPosition();a.event.trigger(o.marker_,"dragend",t)}}),a.event.addListener(o.marker_.getMap(),"mousemove",function(t){var s;if(i){if(r){t.latLng=new a.LatLng(t.latLng.lat()-l,t.latLng.lng()-g);s=o.getProjection().fromLatLngToDivPixel(t.latLng);if(q){o.crossDiv_.style.left=s.x+"px";o.crossDiv_.style.top=s.y+"px";o.crossDiv_.style.display="";s.y-=h}o.marker_.setPosition(o.getProjection().fromDivPixelToLatLng(s));if(q){o.eventDiv_.style.top=(s.y+h)+"px"}a.event.trigger(o.marker_,"drag",t)}else{l=t.latLng.lat()-o.marker_.getPosition().lat();g=t.latLng.lng()-o.marker_.getPosition().lng();p=o.marker_.getZIndex();n=o.marker_.getPosition();f=o.marker_.getMap().getCenter();q=o.marker_.get("raiseOnDrag");r=true;o.marker_.setZIndex(1000000);t.latLng=o.marker_.getPosition();a.event.trigger(o.marker_,"dragstart",t)}}}),a.event.addDomListener(document,"keydown",function(s){if(r){if(s.keyCode===27){q=false;o.marker_.setPosition(n);o.marker_.getMap().setCenter(f);a.event.trigger(document,"mouseup",s)}}}),a.event.addDomListener(this.eventDiv_,"click",function(s){if(o.marker_.getDraggable()||o.marker_.getClickable()){if(e){e=false}else{a.event.trigger(o.marker_,"click",s);k(s)}}}),a.event.addDomListener(this.eventDiv_,"dblclick",function(s){if(o.marker_.getDraggable()||o.marker_.getClickable()){a.event.trigger(o.marker_,"dblclick",s);k(s)}}),a.event.addListener(this.marker_,"dragstart",function(s){if(!r){q=this.get("raiseOnDrag")}}),a.event.addListener(this.marker_,"drag",function(s){if(!r){if(q){o.setPosition(h);o.labelDiv_.style.zIndex=1000000+(this.get("labelInBackground")?-1:+1)}}}),a.event.addListener(this.marker_,"dragend",function(s){if(!r){if(q){o.setPosition(0)}}}),a.event.addListener(this.marker_,"position_changed",function(){o.setPosition()}),a.event.addListener(this.marker_,"zindex_changed",function(){o.setZIndex()}),a.event.addListener(this.marker_,"visible_changed",function(){o.setVisible()}),a.event.addListener(this.marker_,"labelvisible_changed",function(){o.setVisible()}),a.event.addListener(this.marker_,"title_changed",function(){o.setTitle()}),a.event.addListener(this.marker_,"labelcontent_changed",function(){o.setContent()}),a.event.addListener(this.marker_,"labelanchor_changed",function(){o.setAnchor()}),a.event.addListener(this.marker_,"labelclass_changed",function(){o.setStyles()}),a.event.addListener(this.marker_,"labelstyle_changed",function(){o.setStyles()})]};b.prototype.onRemove=function(){var e;this.labelDiv_.parentNode.removeChild(this.labelDiv_);this.eventDiv_.parentNode.removeChild(this.eventDiv_);for(e=0;e<this.listeners_.length;e++){a.event.removeListener(this.listeners_[e])}};b.prototype.draw=function(){this.setContent();this.setTitle();this.setStyles()};b.prototype.setContent=function(){var e=this.marker_.get("labelContent");if(typeof e.nodeType==="undefined"){this.labelDiv_.innerHTML=e;this.eventDiv_.innerHTML=this.labelDiv_.innerHTML}else{while(this.labelDiv_.lastChild){this.labelDiv_.removeChild(this.labelDiv_.lastChild)}while(this.eventDiv_.lastChild){this.eventDiv_.removeChild(this.eventDiv_.lastChild)}this.labelDiv_.appendChild(e);e=e.cloneNode(true);this.eventDiv_.appendChild(e)}};b.prototype.setTitle=function(){this.eventDiv_.title=this.marker_.getTitle()||""};b.prototype.setStyles=function(){var f,e;this.labelDiv_.className=this.marker_.get("labelClass");this.eventDiv_.className=this.labelDiv_.className;this.labelDiv_.style.cssText="";this.eventDiv_.style.cssText="";e=this.marker_.get("labelStyle");for(f in e){if(e.hasOwnProperty(f)){this.labelDiv_.style[f]=e[f];this.eventDiv_.style[f]=e[f]}}this.setMandatoryStyles()};b.prototype.setMandatoryStyles=function(){this.labelDiv_.style.position="absolute";this.labelDiv_.style.overflow="hidden";if(typeof this.labelDiv_.style.opacity!=="undefined"&&this.labelDiv_.style.opacity!==""){this.labelDiv_.style.MsFilter='"progid:DXImageTransform.Microsoft.Alpha(opacity='+(this.labelDiv_.style.opacity*100)+')"';this.labelDiv_.style.filter="alpha(opacity="+(this.labelDiv_.style.opacity*100)+")"}this.eventDiv_.style.position=this.labelDiv_.style.position;this.eventDiv_.style.overflow=this.labelDiv_.style.overflow;this.eventDiv_.style.opacity=0.01;this.eventDiv_.style.MsFilter='"progid:DXImageTransform.Microsoft.Alpha(opacity=1)"';this.eventDiv_.style.filter="alpha(opacity=1)";this.setAnchor();this.setPosition();this.setVisible()};b.prototype.setAnchor=function(){var e=this.marker_.get("labelAnchor");this.labelDiv_.style.marginLeft=-e.x+"px";this.labelDiv_.style.marginTop=-e.y+"px";this.eventDiv_.style.marginLeft=-e.x+"px";this.eventDiv_.style.marginTop=-e.y+"px"};b.prototype.setPosition=function(f){var e=this.getProjection().fromLatLngToDivPixel(this.marker_.getPosition());if(typeof f==="undefined"){f=0}this.labelDiv_.style.left=Math.round(e.x)+"px";this.labelDiv_.style.top=Math.round(e.y-f)+"px";this.eventDiv_.style.left=this.labelDiv_.style.left;this.eventDiv_.style.top=this.labelDiv_.style.top;this.setZIndex()};b.prototype.setZIndex=function(){var e=(this.marker_.get("labelInBackground")?-1:+1);if(typeof this.marker_.getZIndex()==="undefined"){this.labelDiv_.style.zIndex=parseInt(this.labelDiv_.style.top,10)+e;this.eventDiv_.style.zIndex=this.labelDiv_.style.zIndex}else{this.labelDiv_.style.zIndex=this.marker_.getZIndex()+e;this.eventDiv_.style.zIndex=this.labelDiv_.style.zIndex}};b.prototype.setVisible=function(e){if(this.marker_.get("labelVisible")){this.labelDiv_.style.display=this.marker_.getVisible()?"block":"none"}else{this.labelDiv_.style.display="none"}if(e){this.labelDiv_.style.display="block"}this.eventDiv_.style.display=this.labelDiv_.style.display};var c=function(e){e=e||{};e.labelContent=e.labelContent||"";e.labelAnchor=e.labelAnchor||new a.Point(0,0);e.labelClass=e.labelClass||"markerLabels";e.labelStyle=e.labelStyle||{};e.labelInBackground=e.labelInBackground||false;if(typeof e.labelVisible==="undefined"){e.labelVisible=true}if(typeof e.raiseOnDrag==="undefined"){e.raiseOnDrag=true}if(typeof e.clickable==="undefined"){e.clickable=true}if(typeof e.draggable==="undefined"){e.draggable=false}if(typeof e.optimized==="undefined"){e.optimized=false}e.optimized=false;this.label=new b(this,e.crossImage,e.handCursor);a.Marker.apply(this,arguments)};d(c,a.Marker);c.prototype.setMap=function(e){a.Marker.prototype.setMap.apply(this,arguments);this.label.setMap(e)};return c}};